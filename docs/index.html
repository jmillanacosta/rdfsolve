<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDFSolve - Schema Analysis Results</title>
    <link rel="stylesheet" href="style.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Main Content Area -->
        <div class="main-content" id="main-content">
            <header class="header">
                <h1>RDFSolve</h1>
                <p>RDF schema extraction and analysis toolkit</p>
                <nav class="header-nav">
                    <a href="https://rdfsolve.readthedocs.io">Documentation</a>
                    <a href="https://github.com/jmillanacosta/rdfsolve">GitHub</a>
                </nav>
                <div id="last-updated" class="last-updated">Loading...</div>
            </header>

            <section class="stats" id="stats-section">
                <div class="stat-card">
                    <div class="stat-number total-number" id="total-datasets">-</div>
                    <div>Total Datasets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number success-number" id="successful-datasets">-</div>
                    <div>Successful</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number error-number" id="failed-datasets">-</div>
                    <div>Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number data-number" id="total-data-files">-</div>
                    <div>Data Files</div>
                </div>
            </section>

            <!-- Linked Schema Cloud Section -->
            <section class="ls-cloud-section" style="margin-bottom: 32px; padding: 20px; background: var(--card-background); border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h2 class="section-title" style="margin: 0;">Linked Schema Cloud</h2>
                </div>
                
                <!-- Controls Row -->
                <div style="display: flex; gap: 16px; align-items: flex-end; margin-bottom: 16px; flex-wrap: wrap;">
                    <!-- Dataset Selector with Bootstrap Select -->
                    <div style="flex: 1; min-width: 320px; max-width: 500px;">
                        <label for="ls-dataset-select" style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 6px; color: var(--text-secondary);">Select Datasets</label>
                        <select id="ls-dataset-select" class="selectpicker form-control" multiple data-live-search="true" data-actions-box="true" data-selected-text-format="count > 3" data-count-selected-text="{0} datasets selected" title="Choose datasets...">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    
                    <!-- Render Button -->
                    <div>
                        <button id="render-ls-cloud" class="btn btn-primary" style="white-space: nowrap;">
                            Render Graph
                        </button>
                    </div>
                    
                    <!-- Options -->
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ls-exclude-owl" checked>
                            <label class="form-check-label" for="ls-exclude-owl" style="font-size: 12px;">Exclude OWL/RDF(S) nodes</label>
                        </div>
                    </div>
                </div>
                
                <!-- Selected Datasets Preview -->
                <div id="ls-selected-preview" style="margin-bottom: 12px; min-height: 28px;"></div>

                <!-- Graph Container -->
                <div style="border: 1px solid var(--border-color); border-radius: var(--border-radius); background: var(--background-color);">
                    <!-- Toolbar -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid var(--border-color); background: var(--card-background); flex-wrap: wrap; gap: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                            <!-- Node Filter with Bootstrap Select -->
                            <div style="min-width: 200px;">
                                <select id="ls-node-filter" class="selectpicker" data-live-search="true" data-size="10" data-width="200px" title="Focus on node...">
                                    <option value="">All nodes</option>
                                </select>
                            </div>
                            <!-- Neighbor Depth -->
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label for="ls-neighbor-depth" style="font-size: 12px; color: var(--text-secondary);">Depth:</label>
                                <select id="ls-neighbor-depth" style="padding: 4px 8px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 12px;">
                                    <option value="1">1 hop</option>
                                    <option value="2" selected>2 hops</option>
                                    <option value="3">3 hops</option>
                                    <option value="0">All</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Path Finding -->
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <button id="ls-find-path-btn" style="padding: 4px 10px; font-size: 12px; background: var(--background-color); border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer;" title="Select two nodes to find paths">Find Path</button>
                            <span id="ls-path-status" style="font-size: 11px; color: var(--text-secondary);"></span>
                            <button id="ls-show-intersection" style="padding: 4px 10px; font-size: 12px; background: var(--background-color); border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; margin-left: 6px;" title="Dim nodes/edges not present in all selected datasets">Show intersection</button>
                        </div>
                        
                        <!-- Zoom Controls -->
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <button id="ls-zoom-out" title="Zoom Out" style="width: 24px; height: 24px; border: 1px solid var(--border-color); border-radius: var(--border-radius); background: var(--background-color); cursor: pointer; font-size: 14px;">−</button>
                            <button id="ls-zoom-in" title="Zoom In" style="width: 24px; height: 24px; border: 1px solid var(--border-color); border-radius: var(--border-radius); background: var(--background-color); cursor: pointer; font-size: 14px;">+</button>
                            <button id="ls-zoom-fit" style="padding: 4px 8px; border: 1px solid var(--border-color); border-radius: var(--border-radius); background: var(--background-color); cursor: pointer; font-size: 11px;">Reset</button>
                        </div>
                    </div>
                    
                    <!-- Info/Legend Bar -->
                    <div id="ls-info" style="padding: 8px 12px; border-bottom: 1px solid var(--border-color); display: none; font-size: 12px;"></div>
                    
                    <!-- Graph Area with Spacing Sliders -->
                    <div style="display: flex; position: relative;">
                        <!-- Y Spacing Slider (vertical, left side) -->
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: var(--card-background); border-right: 1px solid var(--border-color);">
                            <span style="font-size: 9px; color: var(--text-secondary); writing-mode: vertical-rl; transform: rotate(180deg); margin-bottom: 8px;">Y Spacing</span>
                            <input type="range" id="ls-y-spacing" min="50" max="200" value="100" 
                                   style="writing-mode: vertical-lr; direction: rtl; height: 120px; width: 16px; cursor: pointer;"
                                   title="Vertical spacing between levels">
                            <span id="ls-y-spacing-val" style="font-size: 9px; color: var(--text-secondary); margin-top: 4px;">100%</span>
                        </div>
                        
                        <!-- Main Graph Area -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <div id="ls-diagram" style="min-height: 500px; overflow: hidden; position: relative; background: #fafbfc; flex: 1;">
                                <div style="color: var(--text-secondary); text-align: center; padding: 60px 20px; font-size: 13px;">
                                    <div style="margin-bottom: 8px;">Select datasets above and click <strong>Render Graph</strong></div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Tip: Click nodes to select them for path finding</div>
                                </div>
                            </div>
                            
                            <!-- X Spacing Slider (horizontal, bottom) -->
                            <div style="display: flex; align-items: center; padding: 6px 12px; background: var(--card-background); border-top: 1px solid var(--border-color);">
                                <span style="font-size: 9px; color: var(--text-secondary); margin-right: 8px;">X Spacing</span>
                                <input type="range" id="ls-x-spacing" min="50" max="200" value="100" 
                                       style="flex: 1; max-width: 200px; cursor: pointer;"
                                       title="Horizontal spacing between nodes">
                                <span id="ls-x-spacing-val" style="font-size: 9px; color: var(--text-secondary); margin-left: 8px; min-width: 32px;">100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <h2 class="section-title">Dataset Analysis Results</h2>
                <div id="datasets-grid" class="dataset-grid"></div>
            </section>

            <footer class="footer">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>RDFSolve</h3>
                        <p>Automated RDF schema extraction and analysis toolkit</p>
                    </div>
                    <div class="footer-section">
                        <h4>Resources</h4>
                        <ul class="footer-links">
                            <li><a href="https://github.com/jmillanacosta/rdfsolve">GitHub Repository</a></li>
                            <li><a href="https://pypi.org/project/rdfsolve/">PyPI Package</a></li>
                            <li><a href="https://rdfsolve.readthedocs.io">Read the docs</a></li>
                        </ul>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Coverage Analysis Panel -->
        <div class="dashboard-panel" id="coverage-panel">
            <div class="panel-header">
                <h2>Coverage Analysis</h2>
                <button class="close-panel-btn" data-panel="coverage">&times;</button>
            </div>
            <div class="panel-content">
                <div id="coverage-stats"></div>
                <div class="viz-section">
                    <div class="viz-header">
                        <h3>Coverage vs Occurrence</h3>
                    </div>
                    <div id="coverage-histogram"></div>
                </div>
                <div class="viz-section">
                    <div class="viz-header">
                        <h3>Top Patterns</h3>
                        <label class="show-all-toggle">
                            <input type="checkbox" id="show-all-patterns"> Show All
                        </label>
                    </div>
                    <div id="top-patterns"></div>
                </div>
                <div class="viz-section">
                    <div class="viz-header">
                        <h3>Property Usage</h3>
                        <label class="show-all-toggle">
                            <input type="checkbox" id="show-all-properties"> Show All
                        </label>
                    </div>
                    <div id="property-distribution"></div>
                </div>
            </div>
        </div>

        <!-- Schema Diagram Panel -->
        <div class="dashboard-panel" id="schema-panel">
            <div class="panel-header">
                <h2>Schema Diagram</h2>
                <button class="close-panel-btn" data-panel="schema">&times;</button>
            </div>
            <div class="panel-controls">
                <div class="schema-options" style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer;">
                        <input type="checkbox" id="schema-exclude-owl" checked>
                        Exclude OWL/RDF(S)
                    </label>
                    <div class="zoom-controls">
                        <button id="zoom-out" class="zoom-btn" title="Zoom Out">−</button>
                        <button id="zoom-in" class="zoom-btn" title="Zoom In">+</button>
                        <button id="zoom-fit" class="zoom-btn">Fit</button>
                    </div>
                </div>
            </div>
            <div class="panel-content schema-content" style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
                <div id="schema-info"></div>
                <!-- Graph Area with Spacing Sliders -->
                <div style="display: flex; flex: 1; min-height: 0;">
                    <!-- Y Spacing Slider (vertical, left side) -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: var(--card-background); border-right: 1px solid var(--border-color);">
                        <span style="font-size: 9px; color: var(--text-secondary); writing-mode: vertical-rl; transform: rotate(180deg); margin-bottom: 8px;">Y</span>
                        <input type="range" id="schema-y-spacing" min="50" max="200" value="100" 
                               style="writing-mode: vertical-lr; direction: rtl; height: 100px; width: 14px; cursor: pointer;"
                               title="Vertical spacing">
                        <span id="schema-y-spacing-val" style="font-size: 9px; color: var(--text-secondary); margin-top: 4px;">100%</span>
                    </div>
                    
                    <!-- Main Diagram Area -->
                    <div style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                        <div id="schema-diagram" style="flex: 1; overflow: hidden; min-height: 300px;"></div>
                        
                        <!-- X Spacing Slider (horizontal, bottom) -->
                        <div style="display: flex; align-items: center; padding: 4px 8px; background: var(--card-background); border-top: 1px solid var(--border-color);">
                            <span style="font-size: 9px; color: var(--text-secondary); margin-right: 6px;">X</span>
                            <input type="range" id="schema-x-spacing" min="50" max="200" value="100" 
                                   style="flex: 1; max-width: 150px; cursor: pointer;"
                                   title="Horizontal spacing">
                            <span id="schema-x-spacing-val" style="font-size: 9px; color: var(--text-secondary); margin-left: 6px;">100%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery (required for Bootstrap Select) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
    
    <script src="app.js"></script>
    <script src="coverage_visualization.js"></script>
    <script src="d3_diagram_utils.js"></script>
    <script src="schema_diagram.js"></script>
    <script src="ls_cloud.js"></script>
</body>
</html>
